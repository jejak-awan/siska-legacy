import{p as k,q as L,B as G,c,s as x,o as p,f as e,t as m,v as ne,x as $,j as M,y as V,C as B,D as z,z as P,l as N,E as S,n as re,a as D,e as ie,b as K,d as q,F,k as H,m as de}from"./index-Bo0LgBjO.js";const ue={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},pe={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},me={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ce={class:"mt-3 text-center sm:mt-0 sm:text-left"},ge={class:"text-lg leading-6 font-medium text-gray-900 mb-4"},xe={key:0,class:"mt-1 text-sm text-red-600"},ve={key:0,class:"mt-1 text-sm text-red-600"},be={key:0},fe={key:0,class:"mt-1 text-sm text-red-600"},ke={key:1},ye={class:"flex items-center"},we={key:0,class:"mt-2"},he={key:0,class:"mt-1 text-sm text-red-600"},_e={key:0,class:"mt-1 text-sm text-red-600"},$e={key:0,class:"mt-1 text-sm text-red-600"},Ce={class:"flex items-center"},Me={class:"mt-6 flex items-center justify-end space-x-3"},je=["disabled"],Be=["disabled"],Se={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Ee={__name:"UserFormModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close","saved"],setup(j,{emit:T}){const C=j,b=T,f=k(!1),y=k(!1),n=k({}),r=L({username:"",email:"",password:"",role_type:"",status:"aktif",two_factor_enabled:!1});G(()=>C.user,v=>{v?(r.username=v.username||"",r.email=v.email||"",r.password="",r.role_type=v.role_type||"",r.status=v.status||"aktif",r.two_factor_enabled=v.two_factor_enabled||!1):(r.username="",r.email="",r.password="",r.role_type="",r.status="aktif",r.two_factor_enabled=!1),y.value=!1,n.value={}},{immediate:!0});const w=async()=>{var v,a,d;f.value=!0,n.value={};try{const i={...r};C.user&&!y.value&&delete i.password,C.user?await S.put(`/users/${C.user.id}`,i):await S.post("/users",i),b("saved");const U=C.user?"diupdate":"dibuat";alert(`Pengguna berhasil ${U}`)}catch(i){console.error("Error saving user:",i),((v=i.response)==null?void 0:v.status)===422?n.value=i.response.data.errors||{}:alert(`Error: ${((d=(a=i.response)==null?void 0:a.data)==null?void 0:d.message)||"Terjadi kesalahan"}`)}finally{f.value=!1}};return(v,a)=>j.show?(p(),c("div",ue,[e("div",pe,[e("div",{class:"fixed inset-0 transition-opacity",onClick:a[0]||(a[0]=d=>v.$emit("close"))},[...a[10]||(a[10]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75"},null,-1)])]),e("div",me,[e("div",null,[e("div",ce,[e("h3",ge,m(j.user?"Edit Pengguna":"Tambah Pengguna Baru"),1),e("form",{onSubmit:ne(w,["prevent"]),class:"space-y-4"},[e("div",null,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[M(" Username "),e("span",{class:"text-red-500"},"*")],-1)),$(e("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>r.username=d),type:"text",required:"",class:B(["form-input",{"border-red-500":n.value.username}]),placeholder:"Masukkan username"},null,2),[[V,r.username]]),n.value.username?(p(),c("p",xe,m(n.value.username[0]),1)):x("",!0)]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[M(" Email "),e("span",{class:"text-red-500"},"*")],-1)),$(e("input",{"onUpdate:modelValue":a[2]||(a[2]=d=>r.email=d),type:"email",required:"",class:B(["form-input",{"border-red-500":n.value.email}]),placeholder:"Masukkan email"},null,2),[[V,r.email]]),n.value.email?(p(),c("p",ve,m(n.value.email[0]),1)):x("",!0)]),j.user?x("",!0):(p(),c("div",be,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[M(" Password "),e("span",{class:"text-red-500"},"*")],-1)),$(e("input",{"onUpdate:modelValue":a[3]||(a[3]=d=>r.password=d),type:"password",required:"",class:B(["form-input",{"border-red-500":n.value.password}]),placeholder:"Masukkan password"},null,2),[[V,r.password]]),n.value.password?(p(),c("p",fe,m(n.value.password[0]),1)):x("",!0)])),j.user?(p(),c("div",ke,[e("label",ye,[$(e("input",{"onUpdate:modelValue":a[4]||(a[4]=d=>y.value=d),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[z,y.value]]),a[14]||(a[14]=e("span",{class:"ml-2 text-sm text-gray-700"},"Ubah password",-1))]),y.value?(p(),c("div",we,[$(e("input",{"onUpdate:modelValue":a[5]||(a[5]=d=>r.password=d),type:"password",class:B(["form-input",{"border-red-500":n.value.password}]),placeholder:"Masukkan password baru"},null,2),[[V,r.password]]),n.value.password?(p(),c("p",he,m(n.value.password[0]),1)):x("",!0)])):x("",!0)])):x("",!0),e("div",null,[a[16]||(a[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[M(" Role "),e("span",{class:"text-red-500"},"*")],-1)),$(e("select",{"onUpdate:modelValue":a[6]||(a[6]=d=>r.role_type=d),required:"",class:B(["form-select",{"border-red-500":n.value.role_type}])},[...a[15]||(a[15]=[N('<option value="">Pilih Role</option><option value="admin">Admin</option><option value="guru">Guru</option><option value="siswa">Siswa</option><option value="tendik">Tenaga Kependidikan</option><option value="bk">BK</option><option value="wali_kelas">Wali Kelas</option><option value="osis">OSIS</option><option value="ekstrakurikuler">Ekstrakurikuler</option><option value="orang_tua">Orang Tua</option>',10)])],2),[[P,r.role_type]]),n.value.role_type?(p(),c("p",_e,m(n.value.role_type[0]),1)):x("",!0)]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Status ",-1)),$(e("select",{"onUpdate:modelValue":a[7]||(a[7]=d=>r.status=d),class:B(["form-select",{"border-red-500":n.value.status}])},[...a[17]||(a[17]=[e("option",{value:"aktif"},"Aktif",-1),e("option",{value:"nonaktif"},"Non Aktif",-1),e("option",{value:"suspended"},"Suspended",-1)])],2),[[P,r.status]]),n.value.status?(p(),c("p",$e,m(n.value.status[0]),1)):x("",!0)]),e("div",null,[e("label",Ce,[$(e("input",{"onUpdate:modelValue":a[8]||(a[8]=d=>r.two_factor_enabled=d),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[z,r.two_factor_enabled]]),a[19]||(a[19]=e("span",{class:"ml-2 text-sm text-gray-700"},"Aktifkan Two Factor Authentication",-1))])]),e("div",Me,[e("button",{type:"button",onClick:a[9]||(a[9]=d=>v.$emit("close")),class:"btn btn-secondary",disabled:f.value}," Batal ",8,je),e("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(p(),c("svg",Se,[...a[20]||(a[20]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):x("",!0),M(" "+m(j.user?"Update":"Simpan"),1)],8,Be)])],32)])])])])])):x("",!0)}},Ue={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ze={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Te={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},Ve={class:"mt-3 text-center sm:mt-0 sm:text-left"},Ae={class:"space-y-4"},Le={class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors"},Pe={class:"space-y-1 text-center"},Ie={class:"flex text-sm text-gray-600"},Fe={class:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"},He={key:0,class:"mt-3 p-3 bg-green-50 border border-green-200 rounded-md"},Ne={class:"flex items-center"},Re={class:"ml-3"},Oe={class:"text-sm font-medium text-green-800"},De={class:"text-sm text-green-600"},Ke={key:1,class:"mt-2 text-sm text-red-600"},qe={class:"space-y-3"},Ge={class:"flex items-center"},Xe={class:"flex items-center"},We={class:"flex items-center"},Je={key:0,class:"space-y-2"},Qe={class:"flex items-center justify-between text-sm"},Ye={class:"text-gray-900 font-medium"},Ze={class:"w-full bg-gray-200 rounded-full h-2"},et={class:"mt-6 flex items-center justify-end space-x-3"},tt=["disabled"],st=["disabled"],ot={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},at={__name:"ImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","imported"],setup(j,{emit:T}){const C=T,b=k(null),f=k(!1),y=k(0),n=k(""),r=k(null),w=L({updateExisting:!1,skipErrors:!0,sendNotification:!1}),v=h=>{const s=h.target.files[0];if(!s)return;n.value="";const u=[".csv",".xlsx",".xls"],_="."+s.name.split(".").pop().toLowerCase();if(!u.includes(_)){n.value="Format file tidak didukung. Gunakan CSV, XLSX, atau XLS.";return}if(s.size>2*1024*1024){n.value="Ukuran file terlalu besar. Maksimal 2MB.";return}b.value=s},a=()=>{b.value=null,r.value&&(r.value.value=""),n.value=""},d=()=>{const h=`username,email,password,role_type,status
john_doe,john@example.com,password123,guru,aktif
jane_smith,jane@example.com,password123,siswa,aktif
admin_user,admin@example.com,password123,admin,aktif`,s=new Blob([h],{type:"text/csv"}),u=window.URL.createObjectURL(s),_=document.createElement("a");_.href=u,_.download="template_import_users.csv",document.body.appendChild(_),_.click(),window.URL.revokeObjectURL(u),document.body.removeChild(_)},i=async()=>{var h,s;if(b.value){f.value=!0,y.value=0,n.value="";try{const u=new FormData;u.append("file",b.value),u.append("update_existing",w.updateExisting),u.append("skip_errors",w.skipErrors),u.append("send_notification",w.sendNotification);const _=setInterval(()=>{y.value<90&&(y.value+=10)},200),I=await S.post("/users/import",u,{headers:{"Content-Type":"multipart/form-data"}});clearInterval(_),y.value=100,alert(I.data.message||"Import berhasil dilakukan"),C("imported")}catch(u){console.error("Error importing file:",u),u.value=((s=(h=u.response)==null?void 0:h.data)==null?void 0:s.message)||"Terjadi kesalahan saat import"}finally{f.value=!1,y.value=0}}},U=h=>{if(h===0)return"0 Bytes";const s=1024,u=["Bytes","KB","MB","GB"],_=Math.floor(Math.log(h)/Math.log(s));return parseFloat((h/Math.pow(s,_)).toFixed(2))+" "+u[_]};return(h,s)=>j.show?(p(),c("div",Ue,[e("div",ze,[e("div",{class:"fixed inset-0 transition-opacity",onClick:s[0]||(s[0]=u=>h.$emit("close"))},[...s[5]||(s[5]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75"},null,-1)])]),e("div",Te,[e("div",null,[e("div",Ve,[s[22]||(s[22]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"}," Import Pengguna ",-1)),e("div",Ae,[s[21]||(s[21]=N('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium text-blue-800"> Panduan Import </h3><div class="mt-2 text-sm text-blue-700"><ul class="list-disc list-inside space-y-1"><li>File harus berformat CSV atau Excel (.xlsx, .xls)</li><li>Maksimal ukuran file 2MB</li><li>Kolom wajib: username, email, password, role_type</li><li>Role yang valid: admin, guru, siswa, tendik, bk, wali_kelas, osis, ekstrakurikuler, orang_tua</li></ul></div></div></div></div>',1)),e("div",{class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[s[7]||(s[7]=e("div",null,[e("h4",{class:"text-sm font-medium text-gray-900"},"Template Import"),e("p",{class:"text-sm text-gray-500"},"Download template untuk memudahkan import data")],-1)),e("button",{onClick:d,class:"btn btn-sm btn-outline-primary"},[...s[6]||(s[6]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),M(" Download Template ",-1)])])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Pilih File Import ",-1)),e("div",Le,[e("div",Pe,[s[10]||(s[10]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[e("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("div",Ie,[e("label",Fe,[s[8]||(s[8]=e("span",null,"Upload file",-1)),e("input",{ref_key:"fileInput",ref:r,type:"file",class:"sr-only",accept:".csv,.xlsx,.xls",onChange:v},null,544)]),s[9]||(s[9]=e("p",{class:"pl-1"},"atau drag and drop",-1))]),s[11]||(s[11]=e("p",{class:"text-xs text-gray-500"}," CSV, XLSX, XLS hingga 2MB ",-1))])]),b.value?(p(),c("div",He,[e("div",Ne,[s[13]||(s[13]=e("svg",{class:"h-5 w-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",Re,[e("p",Oe,m(b.value.name),1),e("p",De,m(U(b.value.size)),1)]),e("button",{onClick:a,class:"ml-auto text-green-400 hover:text-green-600"},[...s[12]||(s[12]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):x("",!0),n.value?(p(),c("p",Ke,m(n.value),1)):x("",!0)]),e("div",qe,[s[18]||(s[18]=e("h4",{class:"text-sm font-medium text-gray-900"},"Opsi Import",-1)),e("label",Ge,[$(e("input",{"onUpdate:modelValue":s[1]||(s[1]=u=>w.updateExisting=u),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[z,w.updateExisting]]),s[15]||(s[15]=e("span",{class:"ml-2 text-sm text-gray-700"},"Update pengguna yang sudah ada",-1))]),e("label",Xe,[$(e("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>w.skipErrors=u),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[z,w.skipErrors]]),s[16]||(s[16]=e("span",{class:"ml-2 text-sm text-gray-700"},"Lewati baris yang error",-1))]),e("label",We,[$(e("input",{"onUpdate:modelValue":s[3]||(s[3]=u=>w.sendNotification=u),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[z,w.sendNotification]]),s[17]||(s[17]=e("span",{class:"ml-2 text-sm text-gray-700"},"Kirim notifikasi ke pengguna baru",-1))])]),f.value?(p(),c("div",Je,[e("div",Qe,[s[19]||(s[19]=e("span",{class:"text-gray-600"},"Mengimport data...",-1)),e("span",Ye,m(y.value)+"%",1)]),e("div",Ze,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:re({width:y.value+"%"})},null,4)])])):x("",!0),e("div",et,[e("button",{type:"button",onClick:s[4]||(s[4]=u=>h.$emit("close")),class:"btn btn-secondary",disabled:f.value}," Batal ",8,tt),e("button",{onClick:i,class:"btn btn-primary",disabled:!b.value||f.value},[f.value?(p(),c("svg",ot,[...s[20]||(s[20]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):x("",!0),M(" "+m(f.value?"Mengimport...":"Import Data"),1)],8,st)])])])])])])])):x("",!0)}},lt={class:"py-6"},nt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},rt={class:"mb-8"},it={class:"flex items-center justify-between"},dt={class:"text-sm text-gray-500"},ut={class:"flex items-center space-x-3"},pt={class:"flex items-center space-x-2"},mt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ct={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},gt={class:"flex items-center"},xt={class:"ml-4"},vt={class:"text-2xl font-semibold text-gray-900"},bt={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ft={class:"flex items-center"},kt={class:"ml-4"},yt={class:"text-2xl font-semibold text-gray-900"},wt={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ht={class:"flex items-center"},_t={class:"ml-4"},$t={class:"text-2xl font-semibold text-gray-900"},Ct={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Mt={class:"flex items-center"},jt={class:"ml-4"},Bt={class:"text-2xl font-semibold text-gray-900"},St={class:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6"},Et={class:"p-6"},Ut={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},zt={class:"md:col-span-2"},Tt={class:"relative"},Vt={key:0,class:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200"},At={class:"flex items-center justify-between"},Lt={class:"flex items-center space-x-3"},Pt={class:"flex items-center space-x-2"},It={class:"text-sm font-medium text-blue-900"},Ft={class:"flex items-center space-x-2"},Ht={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},Nt={class:"overflow-x-auto"},Rt={class:"min-w-full divide-y divide-gray-200"},Ot={class:"bg-gray-50"},Dt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Kt=["checked"],qt={class:"bg-white divide-y divide-gray-200"},Gt={key:1},Xt={class:"px-6 py-4 whitespace-nowrap"},Wt=["value"],Jt={class:"px-6 py-4 whitespace-nowrap"},Qt={class:"flex items-center"},Yt={class:"flex-shrink-0 h-10 w-10"},Zt={class:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center"},es={class:"text-blue-600 font-semibold text-sm"},ts={class:"ml-4"},ss={class:"text-sm font-medium text-gray-900"},os={class:"text-sm text-gray-500"},as={class:"px-6 py-4 whitespace-nowrap"},ls={class:"px-6 py-4 whitespace-nowrap"},ns={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},rs={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},is={class:"flex items-center space-x-2"},ds=["onClick"],us=["onClick"],ps=["onClick"],ms=["onClick"],cs={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},gs={class:"flex-1 flex justify-between sm:hidden"},xs=["disabled"],vs=["disabled"],bs={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},fs={class:"text-sm text-gray-700"},ks={class:"font-medium"},ys={class:"font-medium"},ws={class:"font-medium"},hs={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},_s=["disabled"],$s=["onClick"],Cs=["disabled"],js={__name:"UsersView",setup(j){const T=de(),C=k([]),b=k({totalUsers:0,adminCount:0,staffCount:0,studentParentCount:0}),f=k(!1),y=k(!1),n=k([]),r=k(!1),w=k(!1),v=k(!1),a=k(null),d=L({search:"",role_type:"",status:""}),i=L({current_page:1,last_page:1,from:0,to:0,total:0,per_page:15}),U=D(()=>C.value.length>0&&n.value.length===C.value.length),h=D(()=>{const l=[],t=Math.max(1,i.current_page-2),o=Math.min(i.last_page,i.current_page+2);for(let g=t;g<=o;g++)l.push(g);return l}),s=async(l=1)=>{f.value=!0;try{const t={page:l,per_page:i.per_page,...d};Object.keys(t).forEach(g=>{(t[g]===""||t[g]===null)&&delete t[g]});const o=await S.get("/users",{params:t});C.value=o.data.data.data,Object.assign(i,{current_page:o.data.data.current_page,last_page:o.data.data.last_page,from:o.data.data.from,to:o.data.data.to,total:o.data.data.total,per_page:o.data.data.per_page}),n.value=[]}catch(t){console.error("Error loading users:",t)}finally{f.value=!1}},u=async()=>{y.value=!0;try{const l=await S.get("/users-statistics");b.value=l.data.data}catch(l){console.error("Error loading stats:",l)}finally{y.value=!1}},_=(()=>{let l;return()=>{clearTimeout(l),l=setTimeout(()=>{s(1)},500)}})(),I=()=>{U.value?n.value=[]:n.value=C.value.map(l=>l.id)},X=()=>{n.value=[]},W=()=>{d.search="",d.role_type="",d.status="",s(1)},A=async l=>{var o,g;if(!(n.value.length===0||!confirm({activate:"Aktifkan pengguna yang dipilih?",deactivate:"Non-aktifkan pengguna yang dipilih?",suspend:"Suspend pengguna yang dipilih?",delete:"Hapus pengguna yang dipilih? Tindakan ini tidak dapat dibatalkan."}[l])))try{await S.post("/users/bulk-action",{action:l,user_ids:n.value}),n.value=[],await s(i.current_page),await u(),alert(`Bulk ${l} berhasil dilakukan`)}catch(E){console.error(`Error performing bulk ${l}:`,E),alert(`Error: ${((g=(o=E.response)==null?void 0:o.data)==null?void 0:g.message)||"Terjadi kesalahan"}`)}},J=l=>{a.value={...l},w.value=!0},Q=async l=>{var t,o;if(confirm(`Hapus pengguna ${l.username}? Tindakan ini tidak dapat dibatalkan.`))try{await S.delete(`/users/${l.id}`),await s(i.current_page),await u(),alert("Pengguna berhasil dihapus")}catch(g){console.error("Error deleting user:",g),alert(`Error: ${((o=(t=g.response)==null?void 0:t.data)==null?void 0:o.message)||"Terjadi kesalahan"}`)}},R=async(l,t)=>{var o,g;try{await S.post(`/users/${l.id}/${t}`),await s(i.current_page),await u();const E=t==="activate"?"diaktifkan":"dinonaktifkan";alert(`Pengguna ${l.username} berhasil ${E}`)}catch(E){console.error(`Error ${t} user:`,E),alert(`Error: ${((g=(o=E.response)==null?void 0:o.data)==null?void 0:g.message)||"Terjadi kesalahan"}`)}},Y=async()=>{var l,t;try{const o={format:"xlsx",...d},g=await S.post("/users/export",o);alert(g.data.message)}catch(o){console.error("Error exporting users:",o),alert(`Error: ${((t=(l=o.response)==null?void 0:l.data)==null?void 0:t.message)||"Terjadi kesalahan"}`)}},O=()=>{r.value=!1,w.value=!1,a.value=null},Z=()=>{O(),s(i.current_page),u()},ee=()=>{v.value=!1,s(1),u()},te=l=>({admin:"Admin",guru:"Guru",siswa:"Siswa",tendik:"Tendik",bk:"BK",wali_kelas:"Wali Kelas",osis:"OSIS",ekstrakurikuler:"Ekstrakurikuler",orang_tua:"Orang Tua"})[l]||l,se=l=>({admin:"bg-red-100 text-red-800",guru:"bg-blue-100 text-blue-800",siswa:"bg-green-100 text-green-800",tendik:"bg-yellow-100 text-yellow-800",bk:"bg-purple-100 text-purple-800",wali_kelas:"bg-indigo-100 text-indigo-800",osis:"bg-pink-100 text-pink-800",ekstrakurikuler:"bg-orange-100 text-orange-800",orang_tua:"bg-gray-100 text-gray-800"})[l]||"bg-gray-100 text-gray-800",oe=l=>({aktif:"Aktif",nonaktif:"Non Aktif",suspended:"Suspended"})[l]||l,ae=l=>({aktif:"bg-green-100 text-green-800",nonaktif:"bg-gray-100 text-gray-800",suspended:"bg-red-100 text-red-800"})[l]||"bg-gray-100 text-gray-800",le=l=>new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"});return ie(()=>{s(),u()}),G(()=>T.currentRoute.value.query,l=>{l.action==="add"&&(r.value=!0)},{immediate:!0}),(l,t)=>(p(),c("div",lt,[e("div",nt,[e("div",rt,[e("div",it,[e("div",null,[t[16]||(t[16]=e("h1",{class:"text-3xl font-bold text-gray-900"},"Manajemen Pengguna",-1)),t[17]||(t[17]=e("p",{class:"mt-2 text-lg text-gray-600"}," Kelola semua pengguna sistem kesiswaan dengan akses penuh ",-1)),e("p",dt," Total "+m(b.value.totalUsers||0)+" pengguna terdaftar ",1)]),e("div",ut,[e("div",pt,[e("button",{onClick:t[0]||(t[0]=o=>v.value=!0),class:"flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors"},[...t[18]||(t[18]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})],-1),M(" Import ",-1)])]),e("button",{onClick:Y,class:"flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors"},[...t[19]||(t[19]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),M(" Export ",-1)])])]),e("button",{onClick:t[1]||(t[1]=o=>r.value=!0),class:"flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[...t[20]||(t[20]=[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),M(" Tambah Pengguna ",-1)])])])])]),e("div",mt,[e("div",ct,[e("div",gt,[t[22]||(t[22]=e("div",{class:"p-3 bg-blue-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})])],-1)),e("div",xt,[t[21]||(t[21]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Pengguna",-1)),e("p",vt,m(b.value.totalUsers||0),1)])])]),e("div",bt,[e("div",ft,[t[24]||(t[24]=e("div",{class:"p-3 bg-red-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})])],-1)),e("div",kt,[t[23]||(t[23]=e("p",{class:"text-sm font-medium text-gray-600"},"Admin",-1)),e("p",yt,m(b.value.adminCount||0),1)])])]),e("div",wt,[e("div",ht,[t[26]||(t[26]=e("div",{class:"p-3 bg-green-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"})])],-1)),e("div",_t,[t[25]||(t[25]=e("p",{class:"text-sm font-medium text-gray-600"},"Guru & Staff",-1)),e("p",$t,m(b.value.staffCount||0),1)])])]),e("div",Ct,[e("div",Mt,[t[28]||(t[28]=e("div",{class:"p-3 bg-purple-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e("div",jt,[t[27]||(t[27]=e("p",{class:"text-sm font-medium text-gray-600"},"Siswa & Orang Tua",-1)),e("p",Bt,m(b.value.studentParentCount||0),1)])])])]),e("div",St,[e("div",Et,[e("div",{class:"flex items-center justify-between mb-4"},[t[29]||(t[29]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Filter & Pencarian",-1)),e("button",{onClick:W,class:"text-sm text-blue-600 hover:text-blue-700 font-medium"}," Reset Filter ")]),e("div",Ut,[e("div",zt,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Pencarian ",-1)),e("div",Tt,[$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>d.search=o),type:"text",placeholder:"Cari username atau email...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:t[3]||(t[3]=(...o)=>q(_)&&q(_)(...o))},null,544),[[V,d.search]]),t[30]||(t[30]=e("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Role ",-1)),$(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>d.role_type=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:s},[...t[32]||(t[32]=[N('<option value="">Semua Role</option><option value="admin">Admin</option><option value="guru">Guru</option><option value="siswa">Siswa</option><option value="tendik">Tenaga Kependidikan</option><option value="bk">BK</option><option value="wali_kelas">Wali Kelas</option><option value="osis">OSIS</option><option value="ekstrakurikuler">Ekstrakurikuler</option><option value="orang_tua">Orang Tua</option>',10)])],544),[[P,d.role_type]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Status ",-1)),$(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>d.status=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:s},[...t[34]||(t[34]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"aktif"},"Aktif",-1),e("option",{value:"nonaktif"},"Non Aktif",-1),e("option",{value:"suspended"},"Suspended",-1)])],544),[[P,d.status]])])]),n.value.length>0?(p(),c("div",Vt,[e("div",At,[e("div",Lt,[e("div",Pt,[t[36]||(t[36]=e("svg",{class:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",It,m(n.value.length)+" pengguna dipilih ",1)]),e("button",{onClick:X,class:"text-sm text-blue-600 hover:text-blue-700 font-medium"}," Batal Pilih ")]),e("div",Ft,[e("button",{onClick:t[6]||(t[6]=o=>A("activate")),class:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors"}," Aktifkan "),e("button",{onClick:t[7]||(t[7]=o=>A("deactivate")),class:"px-3 py-1 bg-yellow-600 text-white text-sm rounded-lg hover:bg-yellow-700 transition-colors"}," Non-aktifkan "),e("button",{onClick:t[8]||(t[8]=o=>A("suspend")),class:"px-3 py-1 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700 transition-colors"}," Suspend "),e("button",{onClick:t[9]||(t[9]=o=>A("delete")),class:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors"}," Hapus ")])])])):x("",!0)])]),e("div",Ht,[e("div",Nt,[e("table",Rt,[e("thead",Ot,[e("tr",null,[e("th",Dt,[e("input",{type:"checkbox",checked:U.value,onChange:I,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,40,Kt)]),t[37]||(t[37]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Pengguna ",-1)),t[38]||(t[38]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role ",-1)),t[39]||(t[39]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ",-1)),t[40]||(t[40]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Bergabung ",-1)),t[41]||(t[41]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aksi ",-1))])]),e("tbody",qt,[f.value?(p(),c(F,{key:0},H(5,o=>e("tr",{key:o},[...t[42]||(t[42]=[e("td",{colspan:"6",class:"px-6 py-4"},[e("div",{class:"animate-pulse flex space-x-4"},[e("div",{class:"rounded-full bg-gray-200 h-10 w-10"}),e("div",{class:"flex-1 space-y-2 py-1"},[e("div",{class:"h-4 bg-gray-200 rounded w-3/4"}),e("div",{class:"h-4 bg-gray-200 rounded w-1/2"})])])],-1)])])),64)):C.value.length===0?(p(),c("tr",Gt,[...t[43]||(t[43]=[e("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"}," Tidak ada pengguna ditemukan ",-1)])])):(p(!0),c(F,{key:2},H(C.value,o=>(p(),c("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",Xt,[$(e("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":t[10]||(t[10]=g=>n.value=g),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Wt),[[z,n.value]])]),e("td",Jt,[e("div",Qt,[e("div",Yt,[e("div",Zt,[e("span",es,m(o.username.charAt(0).toUpperCase()),1)])]),e("div",ts,[e("div",ss,m(o.username),1),e("div",os,m(o.email),1)])])]),e("td",as,[e("span",{class:B(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",se(o.role_type)])},m(te(o.role_type)),3)]),e("td",ls,[e("span",{class:B(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",ae(o.status)])},m(oe(o.status)),3)]),e("td",ns,m(le(o.created_at)),1),e("td",rs,[e("div",is,[e("button",{onClick:g=>J(o),class:"text-blue-600 hover:text-blue-900",title:"Edit"},[...t[44]||(t[44]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ds),o.status==="aktif"?(p(),c("button",{key:0,onClick:g=>R(o,"deactivate"),class:"text-orange-600 hover:text-orange-900",title:"Non-aktifkan"},[...t[45]||(t[45]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})],-1)])],8,us)):(p(),c("button",{key:1,onClick:g=>R(o,"activate"),class:"text-green-600 hover:text-green-900",title:"Aktifkan"},[...t[46]||(t[46]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,ps)),o.role_type!=="admin"?(p(),c("button",{key:2,onClick:g=>Q(o),class:"text-red-600 hover:text-red-900",title:"Hapus"},[...t[47]||(t[47]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ms)):x("",!0)])])]))),128))])])]),i.total>0?(p(),c("div",cs,[e("div",gs,[e("button",{onClick:t[11]||(t[11]=o=>s(i.current_page-1)),disabled:i.current_page<=1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"}," Previous ",8,xs),e("button",{onClick:t[12]||(t[12]=o=>s(i.current_page+1)),disabled:i.current_page>=i.last_page,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"}," Next ",8,vs)]),e("div",bs,[e("div",null,[e("p",fs,[t[48]||(t[48]=M(" Showing ",-1)),e("span",ks,m(i.from),1),t[49]||(t[49]=M(" to ",-1)),e("span",ys,m(i.to),1),t[50]||(t[50]=M(" of ",-1)),e("span",ws,m(i.total),1),t[51]||(t[51]=M(" results ",-1))])]),e("div",null,[e("nav",hs,[e("button",{onClick:t[13]||(t[13]=o=>s(i.current_page-1)),disabled:i.current_page<=1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50"},[...t[52]||(t[52]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,_s),(p(!0),c(F,null,H(h.value,o=>(p(),c("button",{key:o,onClick:g=>s(o),class:B(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",o===i.current_page?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])},m(o),11,$s))),128)),e("button",{onClick:t[14]||(t[14]=o=>s(i.current_page+1)),disabled:i.current_page>=i.last_page,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50"},[...t[53]||(t[53]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Cs)])])])])):x("",!0)])]),r.value||w.value?(p(),K(Ee,{key:0,user:a.value,show:r.value||w.value,onClose:O,onSaved:Z},null,8,["user","show"])):x("",!0),v.value?(p(),K(at,{key:1,show:v.value,onClose:t[15]||(t[15]=o=>v.value=!1),onImported:ee},null,8,["show"])):x("",!0)]))}};export{js as default};
